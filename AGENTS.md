# AI Agent Instructions

This document provides technical context for AI coding assistants (like GitHub Copilot, Cursor, Cline, etc.) working on this project.

**ğŸ“ IMPORTANT: Keep This File Updated**

When making significant changes to the project, **always update this AGENTS.md file** to reflect:

- New dependencies or tools added
- Changes to development workflows or scripts
- New architectural patterns or conventions
- Updates to CI/CD pipelines
- New configuration files or their purposes
- Changes to code style guidelines or formatters

**Note**: Detailed step-by-step contribution instructions and user-facing documentation belong in CONTRIBUTING.md and README.md respectively. This file provides technical context and conventions that AI agents need to work effectively on the codebase.

This ensures future AI assistants have accurate context about the project.

## Project Overview

**rspress-language-tabs** is a TypeScript-based Rspress v2 component library that provides tabbed code examples with programming language icons from Simple Icons.

- **Language**: TypeScript (ESM)
- **Framework**: React 18/19
- **Build Tool**: Rslib (Rspack-based)
- **Package Manager**: Bun
- **Linter/Formatter**: Biome
- **Target**: Rspress v2.0.0-beta.35+
- **Structure**: Monorepo with Bun workspaces

## Key Features

1. **Language Icons**: Automatically displays icons for 40+ programming languages
2. **Dark Mode Support**: Icons adjust colors for light/dark themes using Rspress's `useDark()` hook
3. **TypeScript**: Fully typed with exported type definitions
4. **Zero Config**: Works out of the box in Rspress projects

## Architecture

### Monorepo Structure

```
rspress-language-tabs/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ rspress-language-tabs/    # Main plugin package (published to npm)
â”‚   â”‚   â”œâ”€â”€ src/                   # Plugin source code
â”‚   â”‚   â”œâ”€â”€ dist/                  # Built output
â”‚   â”‚   â”œâ”€â”€ package.json           # Plugin package config
â”‚   â”‚   â”œâ”€â”€ tsconfig.json          # TypeScript config
â”‚   â”‚   â””â”€â”€ rslib.config.ts        # Build config
â”‚   â””â”€â”€ website/                   # Documentation website
â”‚       â”œâ”€â”€ docs/                  # Documentation content
â”‚       â”œâ”€â”€ rspress.config.ts      # Rspress config
â”‚       â””â”€â”€ package.json           # Website dependencies
â”œâ”€â”€ package.json                   # Monorepo root (private)
â”œâ”€â”€ bun.lock                       # Lockfile for all packages
â””â”€â”€ .github/workflows/             # CI/CD workflows
```

### Component Structure

```
LanguageTabs (Container)
  â”œâ”€â”€ Uses Rspress's <Tabs> component
  â”œâ”€â”€ Maps children to extract language info
  â””â”€â”€ Renders language icons alongside tab labels

LanguageTab (Individual Tab)
  â””â”€â”€ Wraps Rspress's <Tab> component
```

### Icon System

- Icons from `simple-icons` package (40+ languages)
- `getLanguageIcon()` function returns React SVG elements
- `adjustColorForDarkMode()` ensures visibility in dark mode
- Supports language aliases (jsâ†’javascript, pyâ†’python, etc.)

### Dark Mode

The plugin uses Rspress's `useDark()` hook to detect theme:

```typescript
const isDark = useDark();
const icon = getLanguageIcon(language, { isDark });
```

Color adjustment logic:

- Very dark colors (brightness < 50): Boost by 2.5x + add base 100
- Moderately dark (50-127): Boost by 2.0x
- Light colors: Slightly dim by 0.9x

## Development Guidelines

### Code Style

This project uses a **dual-formatter** approach:

- **Biome**: Handles linting and formatting for TypeScript, JavaScript, JSON, and other code files
- **Prettier**: Handles formatting for Markdown (`.md`) and MDX (`.mdx`) documentation files only

Use TypeScript for all source files, prefer functional components with hooks, and export types for public API.

**Formatting Commands:**

```bash
bun run format              # Format all files (Biome + Prettier)
bun run format:biome        # Format only TS/JS/JSON with Biome
bun run format:prettier     # Format only MD/MDX with Prettier
bun run lint                # Check both code and markdown formatting
bun run lint:js             # Run Biome linter on code
bun run lint:md             # Check Markdown/MDX formatting
```

**Configuration Files:**

- `.prettierrc` - Prettier config (markdown/MDX only)
- `.prettierignore` - Excludes CHANGELOG.md (auto-generated by Release Please) and build outputs
- `biome.json` - Biome configuration for code files

### Commit Messages

**IMPORTANT**: This project uses **Conventional Commits** for automated releases.

Format: `<type>[optional scope]: <description>`

Common types:

- `feat`: New feature (minor version bump)
- `fix`: Bug fix (patch version bump)
- `docs`: Documentation changes
- `chore`: Maintenance tasks
- `refactor`: Code refactoring
- `perf`: Performance improvement

Breaking changes: Add `!` after type (e.g., `feat!: change API`)

**CI automatically validates** commit messages. Non-compliant commits will fail the build.

### Dependency Management

This is a **Bun workspace monorepo** following conventional patterns:

- Root `package.json` is private and manages the workspace
- Each package in `packages/` is self-contained
- Use **Bun catalog** for shared dependencies like `@rspress/core`
- Catalog defined in root `package.json`:
  ```json
  "workspaces": {
    "packages": ["packages/*"],
    "catalog": {
      "@rspress/core": "2.0.0-beta.35"
    }
  }
  ```
- Website uses `"rspress-language-tabs": "workspace:*"` to reference the plugin
- Install deps from root: `bun install` (installs all workspaces)
- Install package-specific deps: `cd packages/<package> && bun add <dep>`
- Update catalog version in one place to update everywhere

### Testing

Manual testing via `website`:

```bash
bun install                         # Install all workspace dependencies
bun run build                       # Build plugin
cd packages/website
bun run dev                         # Test at http://localhost:3000
```

**Note**: The website uses `workspace:*` to automatically link to the plugin package. After building the plugin, the website can import and use it directly.

Always test:

- Light and dark modes
- New language icons
- TypeScript compilation
- Build output

### Adding New Languages

1. Check icon exists: https://simpleicons.org/
2. Import from simple-icons in `packages/rspress-language-tabs/src/languageIcons.tsx`
3. Add to `languageToIconMap`
4. Add common aliases
5. Add to `SupportedLanguage` type
6. Build plugin: `bun run build`
7. Test in website: `cd packages/website && bun run dev`
8. Update README and CONTRIBUTING.md

Example:

```typescript
import { siNewLang } from "simple-icons";

const languageToIconMap = {
  newlang: siNewLang,
  nl: siNewLang, // alias
  // ...
};
```

## CI/CD

### Workflows

1. **build.yaml**: Runs on PRs and pushes to main
   - Lints commit messages
   - Checks formatting (both Biome and Prettier)
   - Runs Biome linter
   - Builds the plugin from `packages/rspress-language-tabs`
   - Verifies package contents

2. **release-please.yml**: Automated releases
   - Creates release PRs based on conventional commits
   - Tracks version in `packages/rspress-language-tabs/package.json`
   - Auto-publishes to npm from `packages/rspress-language-tabs` when merged
   - Uses npm Trusted Publishing (OIDC, no tokens needed)

3. **deploy-website.yml**: Deploys documentation to GitHub Pages
   - Triggers on pushes to main or manual workflow dispatch
   - Builds the plugin first
   - Builds the website from `packages/website` (workspace dependency auto-resolves)
   - Deploys to GitHub Pages at https://maccuaa.github.io/rspress-language-tabs/
   - Uses GitHub Pages environment with OIDC authentication

### Release Process

1. Merge PRs with conventional commits to main
2. Release Please creates/updates a release PR
3. Review the changelog in the PR
4. Merge the release PR
5. GitHub Action automatically publishes to npm

**Do not**:

- Manually bump versions
- Create tags manually
- Run `npm publish` locally

## Important Files

- `packages/rspress-language-tabs/src/languageIcons.tsx` - Icon utilities and mappings
- `packages/rspress-language-tabs/src/LanguageTabs.tsx` - Main components
- `packages/rspress-language-tabs/rslib.config.ts` - Plugin build configuration
- `packages/rspress-language-tabs/package.json` - Plugin package config (published to npm)
- `packages/website/` - Documentation website
- `commitlint.config.js` - Commit validation (uses @commitlint/config-conventional)
- `release-please-config.json` - Release automation config
- `.release-please-manifest.json` - Current version tracking
- `biome.json` - Biome linter/formatter configuration
- `.prettierrc` - Prettier configuration (Markdown/MDX only)

## Common Tasks

### Add Dark Mode Support to Icons

Icons already support dark mode via `isDark` prop. The `useDark()` hook detects theme automatically.

### Update Rspress Version

Update catalog in root `package.json`, then run `bun install`.

### Fix Lint Errors

```bash
bun run lint
```

### Validate Commits Locally

```bash
bun run lint:commits  # Checks last 10 commits
```

## Gotchas

1. **Icon colors**: Very dark icons need special handling in dark mode. Use `adjustColorForDarkMode()`.
2. **Workspace structure**: Root package + website. Don't install deps in wrong location.
3. **Bun vs npm**: Use Bun for dev, but npm for publishing (configured in CI).
4. **Conventional commits**: Commit validation runs in CI. Bad commits = failed build.
5. **Release Please**: Only works with conventional commits. Random commits won't trigger releases.

## Resources

- [Rspress Documentation](https://rspress.dev/)
- [Rspress Runtime API](https://rspress.dev/api/client-api/api-runtime)
- [Simple Icons](https://simpleicons.org/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Release Please](https://github.com/googleapis/release-please)

## Questions?

Refer to CONTRIBUTING.md for detailed contribution guidelines, or check the README.md for usage examples.
